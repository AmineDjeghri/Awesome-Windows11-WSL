#!/bin/bash
YELLOW=$(printf '\033[1;33m')
RED=$(printf '\033[0;31m')
RESET=$(printf '\033[0m')
GREEN=$(printf '\033[0;32m')

echo " ${YELLOW} Installing apps ${RESET}"
{{ if eq .chezmoi.os "darwin" -}}

# Function to check and install brew packages
install_brew_package() {
  local package=$1
  if ! brew list "$package" &>/dev/null; then
    brew install "$package"
  else
    echo "$package is already installed."
  fi
}

# Function to check and install cask packages
install_cask_package() {
  local cask=$1
  if ! brew list --cask "$cask" &>/dev/null; then
    brew install --cask "$cask"
  else
    echo "$cask is already installed."
  fi
}

# Install brew packages
{{ range .packages.darwin.brews -}}
install_brew_package {{ . | quote }}
{{ end -}}

# Install cask packages
{{ range .packages.darwin.casks -}}
install_cask_package {{ . | quote }}
{{ end -}}

{{ end -}}

########## Linux
{{ if eq .chezmoi.os "linux" -}}

# Function to check and install apt packages
install_apt_package() {
  local package=$1
  if ! dpkg -l | grep -q "^ii  $package "; then
    sudo apt-get update
    sudo apt-get install -y "$package"
  else
    echo "$package is already installed."
  fi
}

# Function to check and install snap packages
install_snap_package() {
  local package=$1
  if ! snap list | grep -q "^$package "; then
    sudo snap install "$package"
  else
    echo "$package is already installed."
  fi
}

# Install apt packages
{{ range .packages.linux.apt -}}
install_apt_package {{ . | quote }}
{{ end -}}

# Install snap packages
{{ range .packages.linux.snap -}}
install_snap_package {{ . | quote }}
{{ end -}}

{{ end -}}
